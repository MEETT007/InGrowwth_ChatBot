<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Company Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0B1E30;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .chatbot-container {
            width: 100%;
            max-width: 500px;
            background-color: #2D3748;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 85vh;
            overflow: hidden;
        }

        .chat-header {
            background-color: #2D3748;
            color: #ffffff;
            padding: 1.5rem;
            border-top-left-radius: 1.5rem;
            border-top-right-radius: 1.5rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: #1F2937;
        }

        .message-container {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .message-container.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-container.bot {
            align-self: flex-start;
        }

        .icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background-color: #3b82f6;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .icon.user {
            background-color: #9CA3AF;
        }

        .icon.bot {
            background-color: #3b82f6;
        }

        .message {
            max-width: calc(80% - 3rem);
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            color: #ffffff;
            word-wrap: break-word;
        }

        .user-message .message {
            background-color: #4A5568;
            border-bottom-right-radius: 0.25rem;
        }

        .bot-message .message {
            background-color: #2D3748;
            border-bottom-left-radius: 0.25rem;
        }

        .chat-input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #4B5563;
            background-color: #2D3748;
            align-items: center;
        }

        .chat-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #4B5563;
            border-radius: 2rem;
            outline: none;
            transition: border-color 0.2s;
            background-color: #1F2937;
            color: #ffffff;
            margin-right: 0.5rem;
        }

        .chat-input:focus {
            border-color: #3b82f6;
        }

        .send-button {
            background-color: #3b82f6;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            background-color: #2563eb;
        }
        
        .upload-button {
            background-color: #4B5563;
            width: 3rem;
            height: 3rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 0.5rem;
            border-radius: 50%;
        }

        .upload-button:hover {
            background-color: #6B7280;
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 1rem;
            color: #9CA3AF;
        }

        .typing-animation {
            display: inline-block;
            animation: typing-pulse 1s infinite;
        }

        @keyframes typing-pulse {
            0%, 60%, 100% {
                transform: scale(1);
            }
            30% {
                transform: scale(1.1);
            }
        }
    </style>
</head>

<body class="bg-gray-900 flex items-center justify-center h-screen p-4">

    <div class="chatbot-container">
        <div class="chat-header">
            InnovateBot
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="message-container bot">
                <div class="icon bot">
                    <!-- Bot Icon SVG -->
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4ZM9 9C9.55228 9 10 8.55228 10 8C10 7.44772 9.55228 7 9 7C8.44772 7 8 7.44772 8 8C8 8.55228 8.44772 9 9 9ZM15 9C15.5523 9 16 8.55228 16 8C16 7.44772 15.5523 7 15 7C14.4477 7 14 7.44772 14 8C14 8.55228 14.4477 9 15 9ZM12 18C14.7614 18 17 15.7614 17 13H7C7 15.7614 9.23858 18 12 18Z" fill="#FFFFFF"/>
                        <path d="M12 18C14.7614 18 17 15.7614 17 13H7C7 15.7614 9.23858 18 12 18Z" fill="#FFFFFF" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="9" cy="8" r="1" fill="#FFFFFF"/>
                        <circle cx="15" cy="8" r="1" fill="#FFFFFF"/>
                    </svg>
                </div>
                <div class="message bot-message">
                    Hello! I'm InnovateBot, your friendly IT support assistant. How can I help you today?
                </div>
            </div>
        </div>
        <div id="loading-indicator" class="loading-indicator">
            <span class="typing-animation">.</span>
            <span class="typing-animation" style="animation-delay: 0.2s;">.</span>
            <span class="typing-animation" style="animation-delay: 0.4s;">.</span>
        </div>
        <div class="chat-input-area">
            <label for="file-input" class="upload-button cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="#ffffff">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
            </label>
            <input type="file" id="file-input" class="hidden" accept="image/*, .pdf">
            <input type="text" id="chat-input" class="chat-input" placeholder="Type your message...">
            <button id="send-button" class="send-button">
                Send
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const loadingIndicator = document.getElementById('loading-indicator');
            const fileInput = document.getElementById('file-input');

            let uploadedImageBase64 = null;

            const apiKey = "";
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

            // This function adds a message to the chat UI with an icon
            function addMessage(text, sender) {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('message-container', sender);

                const iconDiv = document.createElement('div');
                iconDiv.classList.add('icon', sender);

                if (sender === 'user') {
                    iconDiv.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4ZM12 12C14.7614 12 17 14.2386 17 17H7C7 14.2386 9.23858 12 12 12ZM12 10C10.6193 10 9.5 8.88071 9.5 7.5C9.5 6.11929 10.6193 5 12 5C13.3807 5 14.5 6.11929 14.5 7.5C14.5 8.88071 13.3807 10 12 10Z" fill="#FFFFFF"/>
                    </svg>`;
                } else {
                    iconDiv.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4ZM9 9C9.55228 9 10 8.55228 10 8C10 7.44772 9.55228 7 9 7C8.44772 7 8 7.44772 8 8C8 8.55228 8.44772 9 9 9ZM15 9C15.5523 9 16 8.55228 16 8C16 7.44772 15.5523 7 15 7C14.4477 7 14 7.44772 14 8C14 8.55228 14.4477 9 15 9ZM12 18C14.7614 18 17 15.7614 17 13H7C7 15.7614 9.23858 18 12 18Z" fill="#FFFFFF"/>
                        <path d="M12 18C14.7614 18 17 15.7614 17 13H7C7 15.7614 9.23858 18 12 18Z" fill="#FFFFFF" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="9" cy="8" r="1" fill="#FFFFFF"/>
                        <circle cx="15" cy="8" r="1" fill="#FFFFFF"/>
                    </svg>`;
                }

                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', `${sender}-message`);
                messageDiv.textContent = text;
                
                messageContainer.appendChild(iconDiv);
                messageContainer.appendChild(messageDiv);

                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Function to add an image to the chat UI
            function addImageToChat(base64Image) {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('message-container', 'user');

                const iconDiv = document.createElement('div');
                iconDiv.classList.add('icon', 'user');
                iconDiv.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4ZM12 12C14.7614 12 17 14.2386 17 17H7C7 14.2386 9.23858 12 12 12ZM12 10C10.6193 10 9.5 8.88071 9.5 7.5C9.5 6.11929 10.6193 5 12 5C13.3807 5 14.5 6.11929 14.5 7.5C14.5 8.88071 13.3807 10 12 10Z" fill="#FFFFFF"/>
                    </svg>`;
                
                const imgContainer = document.createElement('div');
                imgContainer.classList.add('message', 'user-message');
                const img = document.createElement('img');
                img.src = `data:image/png;base64,${base64Image}`;
                img.classList.add('w-full', 'rounded-lg', 'mt-2', 'max-h-64', 'object-contain', 'mx-auto');
                imgContainer.appendChild(img);

                messageContainer.appendChild(iconDiv);
                messageContainer.appendChild(imgContainer);

                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // This function handles sending a message
            async function sendMessage() {
                const userMessage = chatInput.value.trim();
                if (userMessage === '' && uploadedImageBase64 === null) return;

                // Add user message to UI
                if (userMessage) {
                    addMessage(userMessage, 'user');
                }
                
                chatInput.value = '';

                // Disable the input and button to provide feedback and prevent multiple requests
                chatInput.disabled = true;
                sendButton.disabled = true;
                loadingIndicator.style.display = 'block';

                try {
                    const systemPrompt = "You are an AI assistant for the IT company InGrowwth Innovations, which operates in India. Your name is InnovateBot. Provide concise, helpful answers to common IT questions. Do not answer questions that are not related to IT support, company services, or technology. If a question is out of scope, politely state that you can only assist with IT-related inquiries. Avoid using any formatting, such as bolding, italics, or lists. If a customer asks for pricing, provide the following details: Basic Plan (₹ 5,000 per month), Standard Plan (₹ 10,000 per month), and Premium Plan (₹ 15,000 per month). You can also mention custom plans are available for specific needs.";
                    
                    const contents = [];
                    if (userMessage) {
                        contents.push({ text: userMessage });
                    }
                    if (uploadedImageBase64) {
                        contents.push({ inlineData: { mimeType: "image/png", data: uploadedImageBase64 } });
                    }

                    const payload = {
                        contents: [{ parts: contents }],
                        tools: [{ "google_search": {} }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };

                    let response = null;
                    let retries = 0;
                    const maxRetries = 3;
                    const baseDelay = 1000;

                    while (retries < maxRetries) {
                        try {
                            response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });
                            if (response.status !== 429) {
                                break;
                            }
                            retries++;
                            await new Promise(resolve => setTimeout(resolve, baseDelay * Math.pow(2, retries)));
                        } catch (error) {
                            retries++;
                            await new Promise(resolve => setTimeout(resolve, baseDelay * Math.pow(2, retries)));
                        }
                    }

                    if (!response || !response.ok) {
                        throw new Error('API call failed with status: ' + response.status);
                    }

                    const result = await response.json();
                    const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't get a response. Please try again.";
                    addMessage(botResponse, 'bot');
                } catch (error) {
                    console.error('Error fetching from Gemini API:', error);
                    addMessage("I'm sorry, an error occurred. Please try again later.", 'bot');
                } finally {
                    // Re-enable the input and button and hide the loading indicator
                    chatInput.disabled = false;
                    sendButton.disabled = false;
                    loadingIndicator.style.display = 'none';
                    uploadedImageBase64 = null; // Clear the uploaded image
                    fileInput.value = ''; // Clear the file input for next use
                    chatInput.focus();
                }
            }

            // Event listener for the send button
            sendButton.addEventListener('click', sendMessage);

            // Event listener for the Enter key on the input field
            chatInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });

            // Event listener for file input change
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.type === 'application/pdf') {
                        alert('PDF file uploaded. I can\'t process the content of this file yet, but you can still send your message to the bot.');
                        return; // Exit without processing for now
                    }
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Store the Base64 data of the image
                        uploadedImageBase64 = e.target.result.split(',')[1];
                        addImageToChat(uploadedImageBase64); // Add image to the chat UI
                        alert('Image uploaded and ready to send with your next message!');
                    };
                    reader.readAsDataURL(file);
                }
            });
            // Custom alert function to replace window.alert
            function alert(message) {
                const alertDiv = document.createElement('div');
                alertDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #2D3748;
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
                    z-index: 1000;
                    text-align: center;
                `;
                alertDiv.textContent = message;
                document.body.appendChild(alertDiv);
                setTimeout(() => {
                    alertDiv.remove();
                }, 3000); // Remove alert after 3 seconds
            }
        });
    </script>
</body>

</html>
